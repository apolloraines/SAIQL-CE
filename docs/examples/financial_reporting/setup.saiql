/**
 * Financial Reporting System Database Setup
 * 
 * Complete accounting and financial analysis database schema
 * Supports multi-entity, multi-currency financial reporting and compliance
 * 
 * Schema Overview:
 * - Chart of Accounts: Complete account hierarchy (Assets, Liabilities, Equity, Revenue, Expenses)
 * - General Ledger: All financial transactions with full audit trail
 * - Journals: Different journal types (General, Sales, Purchase, Payroll, etc.)
 * - Entities: Multi-company/division support with consolidation
 * - Currencies: Multi-currency support with exchange rates
 * - Budgets: Budget planning and variance analysis
 * - Cost Centers: Departmental and project cost tracking
 * - Fixed Assets: Asset management with depreciation
 * - Accounts Payable/Receivable: Vendor and customer account management
 * - Cash Flow: Cash management and forecasting
 * 
 * Compliance Features:
 * - GAAP/IFRS compliant account structure
 * - SOX compliance audit trails
 * - Multi-period comparative reporting
 * - Automated journal entry validation
 * - Period-end closing workflows
 * 
 * Usage: Run this file to create complete financial reporting environment
 * Author: Apollo & Claude
 * Version: 1.0.0
 * Database: Multi-dialect support with financial data optimizations
 */

// =============================================================================
// TRANSACTION START - Ensure atomic schema creation
// =============================================================================

$1;  // BEGIN TRANSACTION

// =============================================================================
// MASTER DATA TABLES - Reference data for financial system
// =============================================================================

/**
 * ENTITIES TABLE
 * Support for multi-company/multi-entity reporting
 */
@A[entities]::
    entity_id BIGINT !1 !6(nextval('entity_seq')),
    entity_code VARCHAR(10) !3 !4,
    entity_name VARCHAR(100) !4,
    entity_type VARCHAR(20) !6('subsidiary'),  // parent, subsidiary, division, project
    parent_entity_id BIGINT !2(entities.entity_id),
    
    // Legal information
    legal_name VARCHAR(200),
    tax_id VARCHAR(50),
    incorporation_date DATE,
    legal_structure VARCHAR(50),  // corporation, llc, partnership, etc.
    
    // Address information
    address_line1 VARCHAR(200),
    address_line2 VARCHAR(200),
    city VARCHAR(100),
    state_province VARCHAR(100),
    postal_code VARCHAR(20),
    country VARCHAR(100) !6('United States'),
    
    // Financial configuration
    base_currency VARCHAR(3) !6('USD'),
    fiscal_year_end DATE !6('2024-12-31'),
    reporting_currency VARCHAR(3) !6('USD'),
    
    // Status and dates
    is_active BOOLEAN !6(true),
    consolidation_required BOOLEAN !6(true),
    created_at TIMESTAMP !6(CURRENT_TIMESTAMP),
    updated_at TIMESTAMP !6(CURRENT_TIMESTAMP)
>>oQ;

/**
 * CURRENCIES TABLE
 * Multi-currency support with exchange rates
 */
@A[currencies]::
    currency_code VARCHAR(3) !1,
    currency_name VARCHAR(50) !4,
    currency_symbol VARCHAR(5),
    decimal_places INTEGER !6(2),
    is_active BOOLEAN !6(true),
    created_at TIMESTAMP !6(CURRENT_TIMESTAMP)
>>oQ;

/**
 * EXCHANGE_RATES TABLE
 * Historical exchange rates for currency conversion
 */
@A[exchange_rates]::
    rate_id BIGINT !1 !6(nextval('exchange_rate_seq')),
    from_currency VARCHAR(3) !4 !2(currencies.currency_code),
    to_currency VARCHAR(3) !4 !2(currencies.currency_code),
    rate_date DATE !4,
    exchange_rate DECIMAL(12,6) !4,
    rate_type VARCHAR(20) !6('spot'),  // spot, average, budget
    created_at TIMESTAMP !6(CURRENT_TIMESTAMP)
>>oQ;

/**
 * FISCAL_PERIODS TABLE
 * Accounting periods for financial reporting
 */
@A[fiscal_periods]::
    period_id BIGINT !1 !6(nextval('period_seq')),
    entity_id BIGINT !4 !2(entities.entity_id),
    period_code VARCHAR(10) !4,  // 2024-01, 2024-Q1, 2024-FY
    period_name VARCHAR(50) !4,  // January 2024, Q1 2024, FY 2024
    period_type VARCHAR(10) !4,  // month, quarter, year
    
    // Period dates
    start_date DATE !4,
    end_date DATE !4,
    
    // Period status
    is_current BOOLEAN !6(false),
    is_closed BOOLEAN !6(false),
    closed_date TIMESTAMP,
    closed_by VARCHAR(100),
    
    // Hierarchy
    parent_period_id BIGINT !2(fiscal_periods.period_id),  // Quarter parent for months
    fiscal_year INTEGER !4,
    
    created_at TIMESTAMP !6(CURRENT_TIMESTAMP)
>>oQ;

/**
 * CHART_OF_ACCOUNTS TABLE
 * Complete account hierarchy following GAAP structure
 */
@A[chart_of_accounts]::
    account_id BIGINT !1 !6(nextval('account_seq')),
    entity_id BIGINT !4 !2(entities.entity_id),
    account_code VARCHAR(20) !4,
    account_name VARCHAR(100) !4,
    account_description TEXT,
    
    // Account classification
    account_type VARCHAR(20) !4,  // asset, liability, equity, revenue, expense
    account_subtype VARCHAR(30),   // current_asset, fixed_asset, current_liability, etc.
    account_category VARCHAR(50),  // cash, receivables, inventory, etc.
    
    // Account behavior
    normal_balance VARCHAR(10) !4,  // debit, credit
    is_control_account BOOLEAN !6(false),
    parent_account_id BIGINT !2(chart_of_accounts.account_id),
    account_level INTEGER !6(1),
    account_path TEXT,  // 1000 > 1100 > 1110
    
    // Posting rules
    allow_posting BOOLEAN !6(true),
    require_cost_center BOOLEAN !6(false),
    require_project BOOLEAN !6(false),
    
    // Financial statement mapping
    balance_sheet_section VARCHAR(30),    // current_assets, fixed_assets, etc.
    income_statement_section VARCHAR(30), // revenue, cost_of_sales, operating_expenses, etc.
    cash_flow_section VARCHAR(30),        // operating, investing, financing
    
    // Status
    is_active BOOLEAN !6(true),
    effective_date DATE !6(CURRENT_DATE),
    inactive_date DATE,
    
    created_at TIMESTAMP !6(CURRENT_TIMESTAMP),
    updated_at TIMESTAMP !6(CURRENT_TIMESTAMP)
>>oQ;

/**
 * COST_CENTERS TABLE
 * Departmental and project cost tracking
 */
@A[cost_centers]::
    cost_center_id BIGINT !1 !6(nextval('cost_center_seq')),
    entity_id BIGINT !4 !2(entities.entity_id),
    cost_center_code VARCHAR(20) !4,
    cost_center_name VARCHAR(100) !4,
    cost_center_type VARCHAR(20) !6('department'),  // department, project, location
    
    // Hierarchy
    parent_cost_center_id BIGINT !2(cost_centers.cost_center_id),
    cost_center_level INTEGER !6(1),
    cost_center_path TEXT,
    
    // Management
    manager_name VARCHAR(100),
    manager_email VARCHAR(100),
    
    // Budget and analysis
    annual_budget DECIMAL(15,2),
    budget_currency VARCHAR(3) !6('USD'),
    
    // Status
    is_active BOOLEAN !6(true),
    effective_date DATE !6(CURRENT_DATE),
    inactive_date DATE,
    
    created_at TIMESTAMP !6(CURRENT_TIMESTAMP)
>>oQ;

// =============================================================================
// TRANSACTION TABLES - Core financial transaction processing
// =============================================================================

/**
 * JOURNAL_TYPES TABLE
 * Different types of journals for transaction categorization
 */
@A[journal_types]::
    journal_type_id BIGINT !1 !6(nextval('journal_type_seq')),
    journal_code VARCHAR(10) !3 !4,
    journal_name VARCHAR(50) !4,
    journal_description TEXT,
    
    // Automation rules
    auto_numbering BOOLEAN !6(true),
    number_prefix VARCHAR(10),
    require_approval BOOLEAN !6(false),
    
    // Integration flags
    system_generated BOOLEAN !6(false),  // true for automated entries
    
    is_active BOOLEAN !6(true),
    created_at TIMESTAMP !6(CURRENT_TIMESTAMP)
>>oQ;

/**
 * JOURNAL_ENTRIES TABLE
 * Header for all financial transactions
 */
@A[journal_entries]::
    journal_entry_id BIGINT !1 !6(nextval('journal_entry_seq')),
    entity_id BIGINT !4 !2(entities.entity_id),
    journal_type_id BIGINT !4 !2(journal_types.journal_type_id),
    
    // Entry identification
    journal_number VARCHAR(50) !3 !4,
    reference_number VARCHAR(50),
    
    // Entry details
    entry_date DATE !4,
    posting_date DATE !4,
    period_id BIGINT !4 !2(fiscal_periods.period_id),
    
    // Entry description and source
    description TEXT !4,
    source_document VARCHAR(100),
    source_system VARCHAR(50),
    
    // Totals (for validation)
    total_debits DECIMAL(15,2) !6(0),
    total_credits DECIMAL(15,2) !6(0),
    base_currency VARCHAR(3) !6('USD'),
    
    // Status and workflow
    entry_status VARCHAR(20) !6('draft'),  // draft, posted, reversed
    approved_by VARCHAR(100),
    approved_date TIMESTAMP,
    posted_by VARCHAR(100),
    posted_date TIMESTAMP,
    
    // Reversal information
    reversed_by VARCHAR(100),
    reversed_date TIMESTAMP,
    reversal_entry_id BIGINT !2(journal_entries.journal_entry_id),
    
    // Audit trail
    created_by VARCHAR(100) !4,
    created_at TIMESTAMP !6(CURRENT_TIMESTAMP),
    updated_by VARCHAR(100),
    updated_at TIMESTAMP !6(CURRENT_TIMESTAMP)
>>oQ;

/**
 * JOURNAL_ENTRY_LINES TABLE
 * Individual debit/credit lines for each journal entry
 */
@A[journal_entry_lines]::
    line_id BIGINT !1 !6(nextval('journal_line_seq')),
    journal_entry_id BIGINT !4 !2(journal_entries.journal_entry_id),
    line_number INTEGER !4,
    
    // Account information
    account_id BIGINT !4 !2(chart_of_accounts.account_id),
    cost_center_id BIGINT !2(cost_centers.cost_center_id),
    
    // Transaction amounts
    debit_amount DECIMAL(15,2) !6(0),
    credit_amount DECIMAL(15,2) !6(0),
    currency_code VARCHAR(3) !6('USD'),
    
    // Foreign currency handling
    foreign_debit_amount DECIMAL(15,2),
    foreign_credit_amount DECIMAL(15,2),
    foreign_currency_code VARCHAR(3),
    exchange_rate DECIMAL(12,6),
    
    // Line description and reference
    line_description TEXT,
    reference_info VARCHAR(200),
    
    // Analytics dimensions
    project_code VARCHAR(50),
    department_code VARCHAR(50),
    location_code VARCHAR(50),
    
    created_at TIMESTAMP !6(CURRENT_TIMESTAMP)
>>oQ;

// =============================================================================
// BUDGET AND PLANNING TABLES
// =============================================================================

/**
 * BUDGET_VERSIONS TABLE
 * Support for multiple budget versions (original, revised, forecast)
 */
@A[budget_versions]::
    budget_version_id BIGINT !1 !6(nextval('budget_version_seq')),
    entity_id BIGINT !4 !2(entities.entity_id),
    
    // Version identification
    version_code VARCHAR(20) !4,
    version_name VARCHAR(100) !4,
    version_type VARCHAR(20) !6('annual'),  // annual, quarterly, monthly, forecast
    budget_year INTEGER !4,
    
    // Version details
    description TEXT,
    assumptions TEXT,
    
    // Status and workflow
    version_status VARCHAR(20) !6('draft'),  // draft, approved, active, archived
    approved_by VARCHAR(100),
    approved_date TIMESTAMP,
    
    // Effective period
    effective_from DATE !4,
    effective_to DATE !4,
    
    created_by VARCHAR(100) !4,
    created_at TIMESTAMP !6(CURRENT_TIMESTAMP)
>>oQ;

/**
 * BUDGET_DETAILS TABLE
 * Detailed budget amounts by account and period
 */
@A[budget_details]::
    budget_detail_id BIGINT !1 !6(nextval('budget_detail_seq')),
    budget_version_id BIGINT !4 !2(budget_versions.budget_version_id),
    account_id BIGINT !4 !2(chart_of_accounts.account_id),
    cost_center_id BIGINT !2(cost_centers.cost_center_id),
    period_id BIGINT !4 !2(fiscal_periods.period_id),
    
    // Budget amounts
    budget_amount DECIMAL(15,2) !6(0),
    currency_code VARCHAR(3) !6('USD'),
    
    // Additional analytics
    quantity_budget DECIMAL(12,3),
    unit_price DECIMAL(10,4),
    
    // Comments and assumptions
    comments TEXT,
    
    created_at TIMESTAMP !6(CURRENT_TIMESTAMP),
    updated_at TIMESTAMP !6(CURRENT_TIMESTAMP)
>>oQ;

// =============================================================================
// SUBSIDIARY LEDGERS - Detailed transaction tracking
// =============================================================================

/**
 * ACCOUNTS_RECEIVABLE TABLE
 * Customer account management and aging
 */
@A[accounts_receivable]::
    ar_id BIGINT !1 !6(nextval('ar_seq')),
    entity_id BIGINT !4 !2(entities.entity_id),
    
    // Customer information
    customer_code VARCHAR(20) !4,
    customer_name VARCHAR(200) !4,
    customer_email VARCHAR(100),
    
    // Invoice details
    invoice_number VARCHAR(50) !3 !4,
    invoice_date DATE !4,
    due_date DATE !4,
    
    // Amounts
    invoice_amount DECIMAL(15,2) !4,
    payments_received DECIMAL(15,2) !6(0),
    adjustments DECIMAL(15,2) !6(0),
    balance_due DECIMAL(15,2) !4,
    currency_code VARCHAR(3) !6('USD'),
    
    // Status and terms
    payment_terms VARCHAR(50),  // Net 30, 2/10 Net 30
    invoice_status VARCHAR(20) !6('open'),  // open, paid, overdue, written_off
    
    // Collections
    last_payment_date DATE,
    collection_notes TEXT,
    
    created_at TIMESTAMP !6(CURRENT_TIMESTAMP)
>>oQ;

/**
 * ACCOUNTS_PAYABLE TABLE
 * Vendor account management and payment tracking
 */
@A[accounts_payable]::
    ap_id BIGINT !1 !6(nextval('ap_seq')),
    entity_id BIGINT !4 !2(entities.entity_id),
    
    // Vendor information
    vendor_code VARCHAR(20) !4,
    vendor_name VARCHAR(200) !4,
    vendor_email VARCHAR(100),
    
    // Invoice details
    vendor_invoice_number VARCHAR(50) !4,
    invoice_date DATE !4,
    due_date DATE !4,
    received_date DATE,
    
    // Amounts
    invoice_amount DECIMAL(15,2) !4,
    payments_made DECIMAL(15,2) !6(0),
    adjustments DECIMAL(15,2) !6(0),
    balance_due DECIMAL(15,2) !4,
    currency_code VARCHAR(3) !6('USD'),
    
    // Terms and approval
    payment_terms VARCHAR(50),
    discount_terms VARCHAR(50),  // 2/10 Net 30
    approved_by VARCHAR(100),
    approved_date TIMESTAMP,
    
    // Status
    invoice_status VARCHAR(20) !6('pending'),  // pending, approved, paid, disputed
    
    // Payment information
    payment_method VARCHAR(50),
    payment_reference VARCHAR(100),
    payment_date DATE,
    
    created_at TIMESTAMP !6(CURRENT_TIMESTAMP)
>>oQ;

/**
 * FIXED_ASSETS TABLE
 * Asset management with depreciation tracking
 */
@A[fixed_assets]::
    asset_id BIGINT !1 !6(nextval('asset_seq')),
    entity_id BIGINT !4 !2(entities.entity_id),
    
    // Asset identification
    asset_number VARCHAR(20) !3 !4,
    asset_name VARCHAR(200) !4,
    asset_description TEXT,
    asset_category VARCHAR(50),  // equipment, vehicles, buildings, etc.
    
    // Asset details
    manufacturer VARCHAR(100),
    model VARCHAR(100),
    serial_number VARCHAR(100),
    location VARCHAR(100),
    responsible_employee VARCHAR(100),
    
    // Financial information
    acquisition_date DATE !4,
    cost_basis DECIMAL(15,2) !4,
    accumulated_depreciation DECIMAL(15,2) !6(0),
    net_book_value DECIMAL(15,2) !4,
    currency_code VARCHAR(3) !6('USD'),
    
    // Depreciation setup
    depreciation_method VARCHAR(20) !6('straight_line'),  // straight_line, declining_balance, units_of_production
    useful_life_years INTEGER,
    useful_life_units DECIMAL(12,3),
    salvage_value DECIMAL(15,2) !6(0),
    
    // Status
    asset_status VARCHAR(20) !6('active'),  // active, disposed, impaired
    disposal_date DATE,
    disposal_proceeds DECIMAL(15,2),
    
    created_at TIMESTAMP !6(CURRENT_TIMESTAMP),
    updated_at TIMESTAMP !6(CURRENT_TIMESTAMP)
>>oQ;

/**
 * CASH_ACCOUNTS TABLE
 * Bank and cash account management
 */
@A[cash_accounts]::
    cash_account_id BIGINT !1 !6(nextval('cash_account_seq')),
    entity_id BIGINT !4 !2(entities.entity_id),
    account_id BIGINT !4 !2(chart_of_accounts.account_id),
    
    // Bank details
    bank_name VARCHAR(100) !4,
    account_number VARCHAR(50) !4,
    account_type VARCHAR(20) !6('checking'),  // checking, savings, money_market, petty_cash
    routing_number VARCHAR(20),
    
    // Account details
    currency_code VARCHAR(3) !6('USD'),
    opening_balance DECIMAL(15,2) !6(0),
    current_balance DECIMAL(15,2) !6(0),
    available_balance DECIMAL(15,2) !6(0),
    
    // Bank reconciliation
    last_reconciled_date DATE,
    last_statement_date DATE,
    statement_balance DECIMAL(15,2),
    
    // Status and limits
    is_active BOOLEAN !6(true),
    daily_limit DECIMAL(15,2),
    monthly_limit DECIMAL(15,2),
    
    created_at TIMESTAMP !6(CURRENT_TIMESTAMP)
>>oQ;

// =============================================================================
// INDEXES - Performance optimization for financial queries
// =============================================================================

// Entity indexes
#1[entities,entity_code]::>>oQ;
#1[entities,is_active]::>>oQ;

// Chart of accounts indexes
#1[chart_of_accounts,account_code]::>>oQ;
#1[chart_of_accounts,account_type]::>>oQ;
##[chart_of_accounts,entity_id,account_type]::>>oQ;
##[chart_of_accounts,entity_id,is_active]::>>oQ;

// Journal entry indexes
#1[journal_entries,journal_number]::>>oQ;
#1[journal_entries,entry_date]::>>oQ;
#1[journal_entries,posting_date]::>>oQ;
##[journal_entries,entity_id,entry_date]::>>oQ;
##[journal_entries,entity_id,entry_status]::>>oQ;
##[journal_entries,period_id,entry_status]::>>oQ;

// Journal entry lines indexes
#1[journal_entry_lines,journal_entry_id]::>>oQ;
#1[journal_entry_lines,account_id]::>>oQ;
##[journal_entry_lines,account_id,journal_entry_id]::>>oQ;

// Exchange rates indexes
##[exchange_rates,from_currency,to_currency,rate_date]::>>oQ;

// Fiscal periods indexes
##[fiscal_periods,entity_id,start_date,end_date]::>>oQ;
#1[fiscal_periods,is_current]::>>oQ;

// Budget indexes
##[budget_details,budget_version_id,account_id]::>>oQ;
##[budget_details,account_id,period_id]::>>oQ;

// AR/AP indexes
#1[accounts_receivable,customer_code]::>>oQ;
#1[accounts_receivable,due_date]::>>oQ;
#1[accounts_receivable,invoice_status]::>>oQ;
#1[accounts_payable,vendor_code]::>>oQ;
#1[accounts_payable,due_date]::>>oQ;
#1[accounts_payable,invoice_status]::>>oQ;

// =============================================================================
// SAMPLE DATA - Comprehensive financial data for testing
// =============================================================================

/**
 * CURRENCIES - Base currencies for international operations
 */
+V[currencies(currency_code,currency_name,currency_symbol,decimal_places)]::
USD,US Dollar,$,2;
EUR,Euro,€,2;
GBP,British Pound,£,2;
CAD,Canadian Dollar,C$,2;
JPY,Japanese Yen,¥,0;
AUD,Australian Dollar,A$,2;
CHF,Swiss Franc,CHF,2
>>oQ;

/**
 * ENTITIES - Multi-entity structure for consolidation
 */
+V[entities(entity_code,entity_name,entity_type,parent_entity_id,legal_name,tax_id,base_currency)]::
CORP,TechCorp Holdings,parent,NULL,TechCorp Holdings Inc,12-3456789,USD;
TECH,TechCorp Software,subsidiary,1,TechCorp Software LLC,98-7654321,USD;
EURO,TechCorp Europe,subsidiary,1,TechCorp Europe Ltd,GB123456789,EUR;
ASIA,TechCorp Asia,subsidiary,1,TechCorp Asia Pte Ltd,SG2023001,USD
>>oQ;

/**
 * FISCAL_PERIODS - Complete fiscal calendar for 2024
 */
+V[fiscal_periods(entity_id,period_code,period_name,period_type,start_date,end_date,fiscal_year,is_current)]::
1,2024-01,January 2024,month,2024-01-01,2024-01-31,2024,false;
1,2024-02,February 2024,month,2024-02-01,2024-02-29,2024,false;
1,2024-03,March 2024,month,2024-03-01,2024-03-31,2024,true;
1,2024-Q1,Q1 2024,quarter,2024-01-01,2024-03-31,2024,false;
1,2024-FY,FY 2024,year,2024-01-01,2024-12-31,2024,false;
2,2024-01,January 2024,month,2024-01-01,2024-01-31,2024,false;
2,2024-02,February 2024,month,2024-02-01,2024-02-29,2024,false;
2,2024-03,March 2024,month,2024-03-01,2024-03-31,2024,true;
3,2024-01,January 2024,month,2024-01-01,2024-01-31,2024,false;
3,2024-02,February 2024,month,2024-02-01,2024-02-29,2024,false;
3,2024-03,March 2024,month,2024-03-01,2024-03-31,2024,true
>>oQ;

/**
 * EXCHANGE_RATES - Current exchange rates for multi-currency
 */
+V[exchange_rates(from_currency,to_currency,rate_date,exchange_rate,rate_type)]::
USD,EUR,2024-03-01,0.9234,spot;
USD,GBP,2024-03-01,0.7892,spot;
USD,CAD,2024-03-01,1.3456,spot;
USD,JPY,2024-03-01,149.23,spot;
EUR,USD,2024-03-01,1.0830,spot;
GBP,USD,2024-03-01,1.2672,spot;
CAD,USD,2024-03-01,0.7432,spot;
JPY,USD,2024-03-01,0.0067,spot
>>oQ;

/**
 * JOURNAL_TYPES - Standard journal categories
 */
+V[journal_types(journal_code,journal_name,journal_description,auto_numbering,number_prefix)]::
GJ,General Journal,General journal entries,true,GJ;
SJ,Sales Journal,Customer sales transactions,true,SJ;
PJ,Purchase Journal,Vendor purchase transactions,true,PJ;
CRJ,Cash Receipts,Cash receipt transactions,true,CR;
CDJ,Cash Disbursements,Cash payment transactions,true,CD;
PRJ,Payroll Journal,Payroll related entries,true,PR;
ADJ,Adjusting Entries,Period-end adjustments,true,ADJ;
CLS,Closing Entries,Period-end closing entries,true,CLS
>>oQ;

/**
 * CHART_OF_ACCOUNTS - Complete GAAP-compliant chart of accounts
 */
+V[chart_of_accounts(entity_id,account_code,account_name,account_type,account_subtype,normal_balance,balance_sheet_section,income_statement_section,allow_posting)]::
-- ASSETS
1,1000,ASSETS,asset,control,debit,assets,NULL,false;
1,1100,Current Assets,asset,current_asset,debit,current_assets,NULL,false;
1,1110,Cash and Cash Equivalents,asset,current_asset,debit,current_assets,NULL,false;
1,1111,Petty Cash,asset,current_asset,debit,current_assets,NULL,true;
1,1112,Checking Account - Main,asset,current_asset,debit,current_assets,NULL,true;
1,1113,Savings Account,asset,current_asset,debit,current_assets,NULL,true;
1,1114,Money Market Account,asset,current_asset,debit,current_assets,NULL,true;
1,1120,Accounts Receivable,asset,current_asset,debit,current_assets,NULL,false;
1,1121,Accounts Receivable - Trade,asset,current_asset,debit,current_assets,NULL,true;
1,1122,Allowance for Doubtful Accounts,asset,current_asset,credit,current_assets,NULL,true;
1,1130,Inventory,asset,current_asset,debit,current_assets,NULL,false;
1,1131,Raw Materials,asset,current_asset,debit,current_assets,NULL,true;
1,1132,Work in Process,asset,current_asset,debit,current_assets,NULL,true;
1,1133,Finished Goods,asset,current_asset,debit,current_assets,NULL,true;
1,1140,Prepaid Expenses,asset,current_asset,debit,current_assets,NULL,false;
1,1141,Prepaid Insurance,asset,current_asset,debit,current_assets,NULL,true;
1,1142,Prepaid Rent,asset,current_asset,debit,current_assets,NULL,true;
1,1143,Prepaid Software Licenses,asset,current_asset,debit,current_assets,NULL,true;

-- FIXED ASSETS
1,1200,Property Plant and Equipment,asset,fixed_asset,debit,fixed_assets,NULL,false;
1,1210,Land,asset,fixed_asset,debit,fixed_assets,NULL,true;
1,1220,Buildings,asset,fixed_asset,debit,fixed_assets,NULL,true;
1,1221,Accumulated Depreciation - Buildings,asset,fixed_asset,credit,fixed_assets,NULL,true;
1,1230,Equipment,asset,fixed_asset,debit,fixed_assets,NULL,true;
1,1231,Accumulated Depreciation - Equipment,asset,fixed_asset,credit,fixed_assets,NULL,true;
1,1240,Vehicles,asset,fixed_asset,debit,fixed_assets,NULL,true;
1,1241,Accumulated Depreciation - Vehicles,asset,fixed_asset,credit,fixed_assets,NULL,true;
1,1250,Computer Equipment,asset,fixed_asset,debit,fixed_assets,NULL,true;
1,1251,Accumulated Depreciation - Computer Equipment,asset,fixed_asset,credit,fixed_assets,NULL,true;

-- INTANGIBLE ASSETS
1,1300,Intangible Assets,asset,intangible,debit,intangible_assets,NULL,false;
1,1301,Software Licenses,asset,intangible,debit,intangible_assets,NULL,true;
1,1302,Patents,asset,intangible,debit,intangible_assets,NULL,true;
1,1303,Trademarks,asset,intangible,debit,intangible_assets,NULL,true;
1,1304,Goodwill,asset,intangible,debit,intangible_assets,NULL,true;

-- LIABILITIES
1,2000,LIABILITIES,liability,control,credit,liabilities,NULL,false;
1,2100,Current Liabilities,liability,current_liability,credit,current_liabilities,NULL,false;
1,2110,Accounts Payable,liability,current_liability,credit,current_liabilities,NULL,false;
1,2111,Accounts Payable - Trade,liability,current_liability,credit,current_liabilities,NULL,true;
1,2112,Accounts Payable - Other,liability,current_liability,credit,current_liabilities,NULL,true;
1,2120,Accrued Liabilities,liability,current_liability,credit,current_liabilities,NULL,false;
1,2121,Accrued Salaries,liability,current_liability,credit,current_liabilities,NULL,true;
1,2122,Accrued Benefits,liability,current_liability,credit,current_liabilities,NULL,true;
1,2123,Accrued Interest,liability,current_liability,credit,current_liabilities,NULL,true;
1,2124,Accrued Taxes,liability,current_liability,credit,current_liabilities,NULL,true;
1,2130,Short-term Debt,liability,current_liability,credit,current_liabilities,NULL,false;
1,2131,Notes Payable - Short Term,liability,current_liability,credit,current_liabilities,NULL,true;
1,2132,Current Portion Long-term Debt,liability,current_liability,credit,current_liabilities,NULL,true;
1,2140,Deferred Revenue,liability,current_liability,credit,current_liabilities,NULL,false;
1,2141,Deferred Revenue - Software Licenses,liability,current_liability,credit,current_liabilities,NULL,true;
1,2142,Customer Deposits,liability,current_liability,credit,current_liabilities,NULL,true;

-- LONG-TERM LIABILITIES
1,2200,Long-term Liabilities,liability,long_term_liability,credit,long_term_liabilities,NULL,false;
1,2210,Long-term Debt,liability,long_term_liability,credit,long_term_liabilities,NULL,true;
1,2220,Deferred Tax Liability,liability,long_term_liability,credit,long_term_liabilities,NULL,true;
1,2230,Pension Obligations,liability,long_term_liability,credit,long_term_liabilities,NULL,true;

-- EQUITY
1,3000,EQUITY,equity,control,credit,equity,NULL,false;
1,3100,Shareholders Equity,equity,shareholders_equity,credit,equity,NULL,false;
1,3110,Common Stock,equity,shareholders_equity,credit,equity,NULL,true;
1,3120,Additional Paid-in Capital,equity,shareholders_equity,credit,equity,NULL,true;
1,3130,Retained Earnings,equity,shareholders_equity,credit,equity,NULL,true;
1,3140,Treasury Stock,equity,shareholders_equity,debit,equity,NULL,true;
1,3150,Accumulated Other Comprehensive Income,equity,shareholders_equity,credit,equity,NULL,true;

-- REVENUE
1,4000,REVENUE,revenue,control,credit,NULL,revenue,false;
1,4100,Operating Revenue,revenue,operating_revenue,credit,NULL,revenue,false;
1,4110,Software License Revenue,revenue,operating_revenue,credit,NULL,revenue,true;
1,4120,Software Maintenance Revenue,revenue,operating_revenue,credit,NULL,revenue,true;
1,4130,Professional Services Revenue,revenue,operating_revenue,credit,NULL,revenue,true;
1,4140,Training Revenue,revenue,operating_revenue,credit,NULL,revenue,true;
1,4200,Other Revenue,revenue,other_revenue,credit,NULL,other_income,false;
1,4210,Interest Income,revenue,other_revenue,credit,NULL,other_income,true;
1,4220,Investment Income,revenue,other_revenue,credit,NULL,other_income,true;
1,4230,Foreign Exchange Gain,revenue,other_revenue,credit,NULL,other_income,true;

-- COST OF SALES
1,5000,COST OF SALES,expense,cost_of_sales,debit,NULL,cost_of_sales,false;
1,5100,Direct Costs,expense,cost_of_sales,debit,NULL,cost_of_sales,false;
1,5110,Software Development Costs,expense,cost_of_sales,debit,NULL,cost_of_sales,true;
1,5120,Third-party Software Costs,expense,cost_of_sales,debit,NULL,cost_of_sales,true;
1,5130,Professional Services Costs,expense,cost_of_sales,debit,NULL,cost_of_sales,true;
1,5140,Hardware Costs,expense,cost_of_sales,debit,NULL,cost_of_sales,true;

-- OPERATING EXPENSES
1,6000,OPERATING EXPENSES,expense,operating_expense,debit,NULL,operating_expenses,false;
1,6100,Sales and Marketing,expense,operating_expense,debit,NULL,operating_expenses,false;
1,6110,Salaries - Sales,expense,operating_expense,debit,NULL,operating_expenses,true;
1,6111,Commissions,expense,operating_expense,debit,NULL,operating_expenses,true;
1,6112,Marketing Programs,expense,operating_expense,debit,NULL,operating_expenses,true;
1,6113,Advertising,expense,operating_expense,debit,NULL,operating_expenses,true;
1,6114,Trade Shows,expense,operating_expense,debit,NULL,operating_expenses,true;
1,6200,Research and Development,expense,operating_expense,debit,NULL,operating_expenses,false;
1,6210,Salaries - R&D,expense,operating_expense,debit,NULL,operating_expenses,true;
1,6211,Contract Development,expense,operating_expense,debit,NULL,operating_expenses,true;
1,6212,Software Tools,expense,operating_expense,debit,NULL,operating_expenses,true;
1,6300,General and Administrative,expense,operating_expense,debit,NULL,operating_expenses,false;
1,6310,Salaries - Administrative,expense,operating_expense,debit,NULL,operating_expenses,true;
1,6311,Benefits,expense,operating_expense,debit,NULL,operating_expenses,true;
1,6312,Rent Expense,expense,operating_expense,debit,NULL,operating_expenses,true;
1,6313,Utilities,expense,operating_expense,debit,NULL,operating_expenses,true;
1,6314,Insurance,expense,operating_expense,debit,NULL,operating_expenses,true;
1,6315,Professional Fees,expense,operating_expense,debit,NULL,operating_expenses,true;
1,6316,Office Supplies,expense,operating_expense,debit,NULL,operating_expenses,true;
1,6317,Travel and Entertainment,expense,operating_expense,debit,NULL,operating_expenses,true;
1,6318,Depreciation Expense,expense,operating_expense,debit,NULL,operating_expenses,true;
1,6319,Bad Debt Expense,expense,operating_expense,debit,NULL,operating_expenses,true;

-- OTHER EXPENSES
1,7000,OTHER EXPENSES,expense,other_expense,debit,NULL,other_expenses,false;
1,7100,Interest Expense,expense,other_expense,debit,NULL,other_expenses,true;
1,7200,Foreign Exchange Loss,expense,other_expense,debit,NULL,other_expenses,true;
1,7300,Loss on Asset Disposal,expense,other_expense,debit,NULL,other_expenses,true
>>oQ;

/**
 * COST_CENTERS - Departmental structure for cost allocation
 */
+V[cost_centers(entity_id,cost_center_code,cost_center_name,cost_center_type,manager_name)]::
1,CORP,Corporate,department,John Smith;
1,SALES,Sales and Marketing,department,Sarah Johnson;
1,RND,Research and Development,department,Michael Chen;
1,ADMIN,Administration,department,Lisa Davis;
1,PROJ001,Customer Portal Project,project,David Wilson;
1,PROJ002,Mobile App Development,project,Emily Brown
>>oQ;

/**
 * SAMPLE JOURNAL ENTRIES - Q1 2024 financial transactions
 */

-- January 2024 transactions
+V[journal_entries(entity_id,journal_type_id,journal_number,entry_date,posting_date,period_id,description,total_debits,total_credits,entry_status,created_by)]::
1,1,GJ-2024-001,2024-01-02,2024-01-02,1,Initial cash contribution,500000.00,500000.00,posted,admin;
1,2,SJ-2024-001,2024-01-15,2024-01-15,1,Software license sale to ABC Corp,120000.00,120000.00,posted,sales;
1,3,PJ-2024-001,2024-01-20,2024-01-20,1,Office rent payment,15000.00,15000.00,posted,admin;
1,4,CRJ-2024-001,2024-01-25,2024-01-25,1,Customer payment from ABC Corp,120000.00,120000.00,posted,admin;
1,5,PRJ-2024-001,2024-01-31,2024-01-31,1,January payroll,85000.00,85000.00,posted,hr
>>oQ;

-- Journal entry lines for January transactions
+V[journal_entry_lines(journal_entry_id,line_number,account_id,debit_amount,credit_amount,line_description)]::
-- Initial investment (GJ-2024-001)
1,1,5,500000.00,0.00,Cash investment from shareholders;
1,2,28,0.00,500000.00,Common stock issued;

-- Software sale (SJ-2024-001)  
2,1,9,120000.00,0.00,Software license receivable;
2,2,39,0.00,120000.00,Software license revenue;

-- Rent payment (PJ-2024-001)
3,1,75,15000.00,0.00,Office rent expense;
3,2,5,0.00,15000.00,Cash payment for rent;

-- Customer payment (CRJ-2024-001)
4,1,5,120000.00,0.00,Cash received from customer;
4,2,9,0.00,120000.00,Accounts receivable payment;

-- Payroll (PRJ-2024-001)
5,1,58,60000.00,0.00,Engineering salaries;
5,2,50,15000.00,0.00,Sales salaries;
5,3,65,10000.00,0.00,Administrative salaries;
5,4,5,0.00,85000.00,Cash payment for payroll
>>oQ;

/**
 * ACCOUNTS RECEIVABLE - Customer invoices and payments
 */
+V[accounts_receivable(entity_id,customer_code,customer_name,invoice_number,invoice_date,due_date,invoice_amount,payments_received,balance_due,payment_terms,invoice_status)]::
1,ABC001,ABC Corporation,INV-2024-001,2024-01-15,2024-02-14,120000.00,120000.00,0.00,Net 30,paid;
1,XYZ001,XYZ Industries,INV-2024-002,2024-02-01,2024-03-03,85000.00,0.00,85000.00,Net 30,open;
1,DEF001,DEF Services,INV-2024-003,2024-02-15,2024-03-17,95000.00,50000.00,45000.00,Net 30,open;
1,GHI001,GHI Corporation,INV-2024-004,2024-03-01,2024-03-31,150000.00,0.00,150000.00,Net 30,open;
1,JKL001,JKL Systems,INV-2024-005,2024-03-15,2024-04-14,75000.00,0.00,75000.00,Net 30,open
>>oQ;

/**
 * ACCOUNTS PAYABLE - Vendor invoices and payments
 */
+V[accounts_payable(entity_id,vendor_code,vendor_name,vendor_invoice_number,invoice_date,due_date,invoice_amount,payments_made,balance_due,payment_terms,invoice_status)]::
1,SOFT001,Software Vendor Inc,SV-2024-001,2024-01-10,2024-02-09,25000.00,25000.00,0.00,Net 30,paid;
1,UTIL001,City Utilities,UTIL-2024-001,2024-01-31,2024-02-15,3500.00,3500.00,0.00,Net 15,paid;
1,CONS001,IT Consulting Group,CONS-2024-001,2024-02-15,2024-03-17,18000.00,0.00,18000.00,Net 30,approved;
1,SUPP001,Office Supplies Co,OS-2024-001,2024-02-28,2024-03-30,2500.00,0.00,2500.00,Net 30,approved;
1,SOFT002,Cloud Services Inc,CS-2024-001,2024-03-15,2024-04-14,12000.00,0.00,12000.00,Net 30,pending
>>oQ;

/**
 * FIXED ASSETS - Company assets with depreciation
 */
+V[fixed_assets(entity_id,asset_number,asset_name,asset_category,acquisition_date,cost_basis,accumulated_depreciation,net_book_value,depreciation_method,useful_life_years)]::
1,COMP-001,Development Servers,equipment,2023-06-01,45000.00,3750.00,41250.00,straight_line,5;
1,COMP-002,Network Infrastructure,equipment,2023-08-15,28000.00,1867.00,26133.00,straight_line,5;
1,VEH-001,Company Vehicle,vehicles,2023-03-01,35000.00,7000.00,28000.00,straight_line,5;
1,FURN-001,Office Furniture,equipment,2023-01-15,15000.00,2250.00,12750.00,straight_line,7;
1,SOFT-001,Enterprise Software License,equipment,2024-01-01,50000.00,2083.00,47917.00,straight_line,3
>>oQ;

/**
 * CASH ACCOUNTS - Bank accounts for cash management
 */
+V[cash_accounts(entity_id,account_id,bank_name,account_number,account_type,currency_code,current_balance,available_balance)]::
1,5,First National Bank,****1234,checking,USD,485000.00,485000.00;
1,6,First National Bank,****5678,savings,USD,150000.00,150000.00;
1,7,Investment Bank,****9012,money_market,USD,75000.00,75000.00;
1,4,NULL,PETTY-001,petty_cash,USD,2000.00,2000.00
>>oQ;

// =============================================================================
// COMMIT TRANSACTION - Finalize schema and data creation
// =============================================================================

$2;  // COMMIT TRANSACTION

// =============================================================================
// VERIFICATION QUERIES - Validate setup success
// =============================================================================

// Verify table creation and data
*COUNT[entities]::*>>oQ;
*COUNT[chart_of_accounts]::*>>oQ;
*COUNT[journal_entries]::*>>oQ;
*COUNT[journal_entry_lines]::*>>oQ;
*COUNT[accounts_receivable]::*>>oQ;
*COUNT[accounts_payable]::*>>oQ;
*COUNT[fixed_assets]::*>>oQ;
*COUNT[cash_accounts]::*>>oQ;

// Quick financial validation
*3[chart_of_accounts]::account_type,COUNT(*)+{is_active=true}^{account_type}>>oQ;
*3[journal_entries]::entry_status,COUNT(*),SUM(total_debits)^{entry_status}>>oQ;
*SUM[journal_entry_lines]::debit_amount-credit_amount>>oQ;  // Should be 0

// =============================================================================
// SETUP COMPLETE
// =============================================================================

/**
 * FINANCIAL REPORTING SYSTEM SETUP COMPLETE!
 * 
 * Created Tables:
 * ? entities (4 records) - Multi-entity corporate structure
 * ? currencies (7 records) - International currency support
 * ? fiscal_periods (11 records) - Complete fiscal calendar
 * ? chart_of_accounts (80+ records) - GAAP-compliant chart of accounts
 * ? journal_entries (5 records) - Sample financial transactions
 * ? journal_entry_lines (13 records) - Detailed transaction lines
 * ? accounts_receivable (5 records) - Customer account balances
 * ? accounts_payable (5 records) - Vendor account balances
 * ? fixed_assets (5 records) - Asset register with depreciation
 * ? cash_accounts (4 records) - Bank account management
 * ? cost_centers (6 records) - Departmental cost tracking
 * ? journal_types (8 records) - Transaction categorization
 * ? exchange_rates (8 records) - Multi-currency support
 * 
 * Financial Features Enabled:
 * ? Multi-entity consolidation capability
 * ? Multi-currency transactions with real-time conversion
 * ? Complete GAAP chart of accounts structure
 * ? Full audit trail with journal entry system
 * ? Budget planning and variance analysis framework
 * ? Fixed asset management with depreciation
 * ? Accounts receivable and payable management
 * ? Cash flow management and bank reconciliation
 * ? Cost center and project accounting
 * ? Period-end closing and financial reporting
 * 
 * Compliance Ready:
 * ? SOX-compliant audit trails
 * ? GAAP/IFRS account structure
 * ? Multi-period comparative reporting
 * ? Automated balance validation
 * ? Segregation of duties framework
 * 
 * Ready for financial analysis! Use these files:
 * - profit_loss.saiql (P&L statement generation)
 * - cash_flow.saiql (Cash flow statement analysis)  
 * - budget_variance.saiql (Budget vs actual analysis)
 * 
 * Example queries to get started:
 * *3[journal_entry_lines+chart_of_accounts]::account_name,SUM(debit_amount-credit_amount)^{account_id}>>oQ
 * *3[accounts_receivable]::invoice_status,COUNT(*),SUM(balance_due)^{invoice_status}>>oQ
 * *3[journal_entries]::MONTH(entry_date),SUM(total_debits)^{MONTH(entry_date)}>>oQ
 */