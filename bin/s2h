#!/usr/bin/env python3
"""
s2h - Symbolic to Human translator for LoreToken data
Converts symbolic format to human-readable format
"""

import sys
import re

# Reverse symbol mappings (symbol -> human)
SYMBOL_TO_HUMAN = {
    '⟆': 'LORETOKEN',
    '⟐': 'RECORD',
    '⊤': 'TABLE',
    '◊': 'META',
    '⟡': 'TRANSACTION',
    '⟢': 'CHECKPOINT',
    '§': 'symbol:',
    '⏱': 'timestamp:',
    '↗': 'open:',
    '⤊': 'high:',
    '⤋': 'low:',
    '↘': 'close:',
    '▣': 'volume:',
    '⌘': 'timeframe:',
    '⊱': 'created:',
    '⋁': 'version:',
    '⊜': 'compression:',
    '⊞': 'tables:',
    '♯': 'hash:',
    '№': 'count:',
    '⊡': 'schema:',
    '₿': 'BTC-USD',
    'Ξ': 'ETH-USD',
    '◎': 'SOL-USD',
    '✕': 'XRP-USD',
    'Ð': 'DOGE-USD',
    '₳': 'ADA-USD',
    '△': 'AVAX-USD',
    '●': 'DOT-USD',
    '▽': 'MATIC-USD',
    '⬡': 'LINK-USD',
    '✓': 'ACTIVE',
    '✗': 'INACTIVE',
    '◉': 'COMMITTED',
    '◯': 'PENDING',
    '⊗': 'FAILED',
    '⊕': 'INSERT',
    '⊖': 'UPDATE',
    '⊙': 'SELECT',
    '»': ', '
}

def translate_line(line):
    """Translate a symbolic line to human-readable"""
    result = line
    
    # Replace all symbols
    for symbol, human in SYMBOL_TO_HUMAN.items():
        result = result.replace(symbol, human)
    
    # Clean up formatting
    result = result.replace(':[,', ':[')
    result = result.replace(',]', ']')
    
    # Expand compressed numbers (e.g., 117.4k -> 117400)
    result = re.sub(r'(\d+\.?\d*)k', lambda m: str(float(m.group(1)) * 1000), result)
    
    # Convert hex timestamps to decimal
    result = re.sub(r'timestamp:([0-9a-f]+)', 
                   lambda m: f'timestamp:{int(m.group(1), 16)}', result)
    
    return result

def main():
    if len(sys.argv) > 1:
        # File mode
        file_path = sys.argv[1]
        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                for line in f:
                    print(translate_line(line.strip()))
        except Exception as e:
            print(f"Error: {e}", file=sys.stderr)
    else:
        # Pipe mode - read from stdin
        try:
            for line in sys.stdin:
                print(translate_line(line.strip()))
        except KeyboardInterrupt:
            pass
        except Exception as e:
            print(f"Error: {e}", file=sys.stderr)

if __name__ == "__main__":
    main()